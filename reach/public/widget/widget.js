(()=>{var e="reachapp_clientid",t="reachapp_conversationid",n=new URL(document.currentScript.src).origin,a="#111",o=!1,c=0;var i=function(){var t;return null!==(t=localStorage.getItem(e))&&void 0!==t?t:0},l=function(){var e;return null!==(e=localStorage.getItem(t))&&void 0!==e?e:0},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;localStorage.setItem(t,e)},d=function(e){console.log("Widget component generated."),$("#missed-counter").hide(),y()&&Notification.requestPermission((function(e){console.log("notification permission: "+e)}));var t=e.client,d=e.messages,u=e.settings,m=e.links,g=0;document.body.innerHTML+=e.widget,function(e){a=e.color,$("#file-upload").hide(),$("#chat-circle").css("background-color",e.color),$(".chat-submit").css("background-color",e.color),$(".chat-box-header").css("background-color",e.color),$("#widget-title").text(e.name),$("#widget-icon").attr("src","".concat(n,"/").concat(e.img_src))}(u);for(var f=io(m.socketurl),p=i(),h=l(),v=0;v<d.length;v++)I(d[v],"false"==d[v].isAgent,d[v].created_at,v==d.length-1);function w(){var e=$("#chat-input").val();if(""==e.trim())return!1;var t={body:e,isWhisper:!1,isAgent:!1,senderId:p,clientId:p,attachmentId:"0",fileSize:0,fileName:"",conversationId:h,createddtm:Date.now()};!function(e){$.ajax({type:"POST",url:"".concat(n,"/api/message/send"),dataType:"json",data:e,success:function(e){}})}(t),f.emit("send-message",t),I(t)}function I(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];g++;var i=new Date(o).toISOString().slice(0,19).replace("T"," "),l=t?"self":"user",s=t?"You sent this on ".concat(i):"Sent by an agent on ".concat(i),d="";if("0"==e.attachmentId||""==e.attachmentId||null==e.attachmentId)d="<div id='cm-msg-".concat(g,"' class=\"chat-msg ").concat(l,'"><div class="cm-msg-text"> ').concat(e.body," </div><small>").concat(s,"</small></div>");else{var u="".concat(n,"/api/message/download?id=").concat(e.attachmentId),m="".concat(e.fileName," (").concat(r(e.fileSize),")");d="<div id='cm-msg-".concat(g,"' class=\"chat-msg ").concat(l,'"><div class="cm-msg-text"><span class="file-name">').concat(m,'</span><a class="chat-download-link ').concat(l,'" href="').concat(u,'" target="_blank"><span title="Click to download" class="material-icons chat-download">download</span></a></div><small>').concat(s,"</small></div>")}$(".chat-logs").append(d),$(".chat-msg.self>.cm-msg-text").css("background-color",a),$("#cm-msg-"+g).hide().fadeIn(300),t&&$("#chat-input").val(""),c&&$(".chat-logs").stop().animate({scrollTop:$(".chat-logs")[0].scrollHeight},1e3)}function y(){return"undefined"!=typeof Notification||(console.log("Notification is not supported by this browser"),!1)}f.emit("join-room",{room:t.clientId,clientId:t.clientId}),f.on("message",(function(e){"false"==e.isWhisper&&e.clientId==p&&(I(e,"false"==e.isAgent,e.created_at),o||(c++,$("#missed-counter").show(),$("#missed-counter").text(c)),y()&&"granted"===Notification.permission&&(notify=new Notification("REACH",{icon:"".concat(n,"/assets/images/brand/reach-64.png"),body:e.body})))})),f.on("end-session",(function(e){p==e&&(alert("You session with the agent has ended."),$("#chat-body").remove(),s())})),f.on("allow-upload",(function(e){e.clientId==p&&(e.willAllow?$("#file-upload").show():$("#file-upload").hide())})),$("#chat-submit").click((function(e){e.preventDefault(),w()})),$("#chat-input").keyup((function(){var e={body:$("#chat-input").val(),senderId:p,clientId:p,createddtm:Date.now()};f.emit("client-typing",e)})),$("#chat-input").keypress((function(e){"13"==e.which&&w()})),$("#chat-circle").click((function(){$("#chat-circle").toggle("scale"),$(".chat-box").toggle("scale"),o=!0,c=0,$("#missed-counter").hide()})),$(".chat-box-header").click((function(){$("#chat-circle").toggle("scale"),$(".chat-box").toggle("scale"),o=!1,c>0&&($("#missed-counter").text(c),$("#missed-counter").show())})),$("#file-uploader").change((function(){var e=document.getElementById("file-uploader");if(e&&e.files){var t={body:"",isWhisper:!1,isAgent:!1,senderId:p,clientId:p,attachmentId:"0",fileSize:0,fileName:"",conversationId:h,createddtm:Date.now()},a=e.files[0];if(o=null==a?void 0:a.name,new RegExp("("+[".jpg",".jpeg",".bmp","txt","rar","mp4","mp3","rar",".gif",".png","doc","docx","xls","xlsx","js","zip","pdf","ppt","pptx"].join("|").replace(/\./g,"\\.")+")$").test(o)){var o,c=new FormData;c.append("file",a),c.append("document",JSON.stringify(t)),$.ajax({url:"".concat(n,"/api/message/send"),type:"post",data:c,contentType:!1,processData:!1,success:function(e){$("#file-uploader").val(""),t.attachmentId=e.attachmentId,t.fileName=e.fileName,t.fileSize=e.fileSize,f.emit("send-message",t),I(t)},fail:function(e,t,n){console.log(n)}})}else alert("File extension is invalid.")}}))};function r(e){if(!(e||e>0))return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}!function(){var t=document.createElement("link");if(t.rel="stylesheet",t.type="text/css",t.href="".concat(n,"/widget/style.css"),t.media="all",document.head.appendChild(t),!window.jQuery){var a=document.createElement("script");a.src="".concat(n,"/widget/vendor.js"),document.head.appendChild(a)}setTimeout((function(){var t,a=window.location.hostname,o=window.location.href,c={clientId:i(),source:null!=o?o:"Unknown Site",domain:null!=a?a:"Unknown Domain",conversationId:l()};(t=c,$.ajax({type:"POST",url:"".concat(n,"/api/client/validate"),dataType:"json",data:t,success:function(e){return e.data},fail:function(e,t,n){return console.log(n),null}})).then((function(t){if(console.log("ClientId: ".concat(t.client.clientId)),t&&null!=t&&t.widget&&0!=(null==t?void 0:t.client.clientId)){t.isNew&&function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;localStorage.setItem(e,t)}(t.client.clientId),s(t.client.latestConversationId);var n=document.createElement("script");n.src=t.links.socketioLib,document.head.appendChild(n),setTimeout((function(){d(t)}),t.isNew?5e3:3e3)}else console.log(t.status)}))}),1e3)}()})();